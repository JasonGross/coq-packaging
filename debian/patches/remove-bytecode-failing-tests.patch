From: Benjamin Barenblat <bbaren@debian.org>
Date: Sun, 11 Aug 2019 18:33:24 +0200
Subject: Disable tests which require ocamlopt
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

Forwarded: not-needed

Disable unit tests. They require ocamlopt, which isn't available on all
Debian architectures, and GaÃ«tan Gilbert says that "they don't test much
yet" anyway.

Also disable .vio tests, as they run afoul
of https://github.com/coq/coq/issues/9141.
---
 test-suite/Makefile | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- coq.orig/test-suite/Makefile
+++ coq/test-suite/Makefile
@@ -144,7 +144,7 @@
   coqdoc ssr $(wildcard primitive/*) ltac2
 
 # All subsystems
-SUBSYSTEMS := $(VSUBSYSTEMS) misc ide bugs ide vio coqchk output-coqchk coqwc coq-makefile tools $(UNIT_TESTS)
+SUBSYSTEMS := $(VSUBSYSTEMS) misc ide bugs ide coqchk output-coqchk coqwc coq-makefile tools
 
 .csdp.cache: .csdp.cache.test-suite
 	cp $< $@
--- coq.orig/test-suite/coq-makefile/findlib-package-unpacked/run.sh
+++ /dev/null
@@ -1,22 +0,0 @@
-#!/bin/bash
-
-. ../template/init.sh
-mv src/test_plugin.mlpack src/test_plugin.mllib
-
-echo "let () = Foolib.foo ();;" >> src/test_aux.ml
-export OCAMLPATH=$OCAMLPATH:$PWD/findlib
-if which cygpath 2>/dev/null; then
-  # the only way I found to pass OCAMLPATH on win is to have it contain
-  # only one entry
-  OCAMLPATH=$(cygpath -w "$PWD"/findlib)
-  export OCAMLPATH
-fi
-make -C findlib/foo clean
-coq_makefile -f _CoqProject -o Makefile
-cat Makefile.conf
-cat Makefile.local
-make -C findlib/foo
-if which ocamlopt >/dev/null 2>&1; then
-    make
-fi
-make byte
